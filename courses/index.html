<?php
  require_once "../common/Common.php";

  Display::open_page();

  $data = MindTheCones::getRequest( "events/past/" );
  $json = json_decode( $data, true );
?>

        <h2 class="page-header azbr-color">Autocross Course Map Archive</h2>
        <div class="row">
        </div>

  <?php
  foreach( $json as $index => $event ) {
    $course_map = "courses/".date( "Y.m.d", $event[ 'date_ts' ] ).".jpg";
    if ( file_exists( rootDir.$course_map ) ) {

      if ( file_exists( rootDir."courses/".date( "Y.m.d", $event[ 'date_ts' ] ).".l.jpg" ) ) {
        $course_map = "courses/".date( "Y.m.d", $event[ 'date_ts' ] ).".l.jpg";
      }
      $text = date( "l, F d, Y", $event[ 'date_ts' ] )." at ".$event[ 'site_name' ];
      if ( !empty( $event[ 'name' ] ) ){
        $text = $event[ 'name' ]." - ".$text;
      }
?>
                  <option value="<?php echo $course_map; ?>">
                    <?php echo $text; ?>
                  </option>
<?php
    }
  }
?>
        </div>
        <script type="text/javascript">
          $( document ).ready( function() {
            $( "#course-map" ).change( function() {
              $( "#course-map-img" ).attr( 'src', '<?php echo baseHref; ?>' + $( this ).val() );
            });
            $( "#course-map" ).trigger( 'change' );
          });
        </script>

<?php
  Display::close_page(); 
?>
